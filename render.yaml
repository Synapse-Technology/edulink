services:
  - type: web
    name: edulink-web
    env: python
    region: oregon
    plan: free
    buildCommand: "./build.sh"
    startCommand: "cd Edulink && gunicorn Edulink.wsgi:application --bind 0.0.0.0:$PORT"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DJANGO_SETTINGS_MODULE
        value: Edulink.settings.prod
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: False
      - key: DATABASE_URL
        value: postgresql://postgres.kszzwjavodfvxbsglipr:Edulinksynapse254%25@aws-0-eu-west-2.pooler.supabase.com:6543/postgres
      - key: REDIS_URL
        value: redis://:8vGeHnCVI34G3djDnLYx7RmC9FJVQ42b@redis-15858.crce204.eu-west-2-3.ec2.redns.redis-cloud.com:15858/0
      - key: CELERY_BROKER_URL
        value: redis://:8vGeHnCVI34G3djDnLYx7RmC9FJVQ42b@redis-15858.crce204.eu-west-2-3.ec2.redns.redis-cloud.com:15858/1
      - key: CELERY_RESULT_BACKEND
        value: redis://:8vGeHnCVI34G3djDnLYx7RmC9FJVQ42b@redis-15858.crce204.eu-west-2-3.ec2.redns.redis-cloud.com:15858/1
      - key: EMAIL_HOST
        value: smtp.gmail.com
      - key: EMAIL_PORT
        value: 587
      - key: EMAIL_USE_TLS
        value: True
      - key: EMAIL_HOST_USER
        value: synapsetechnology14@gmail.com
      - key: EMAIL_HOST_PASSWORD
        value: mzfw jytm jgxn zrmi
      - key: DEFAULT_FROM_EMAIL
        value: synapsetechnology14@gmail.com
      - key: ADMIN_ALLOWED_IPS
        value: 196.216.85.226

# Database service removed - using external Supabase database
# Connection details are provided via environment variables

# Redis service removed - using external Redis Cloud
# Connection details are provided via environment variables

  - type: worker
    name: edulink-worker
    env: python
    region: oregon
    plan: free
    buildCommand: "./build.sh"
    startCommand: "cd Edulink && celery -A Edulink worker --loglevel=info"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DJANGO_SETTINGS_MODULE
        value: Edulink.settings.prod
      - key: SECRET_KEY
        fromService:
          type: web
          name: edulink-web
          envVarKey: SECRET_KEY
      - key: DATABASE_URL
        value: postgresql://postgres.kszzwjavodfvxbsglipr:Edulinksynapse254%25@aws-0-eu-west-2.pooler.supabase.com:6543/postgres
      - key: REDIS_URL
        value: redis://:8vGeHnCVI34G3djDnLYx7RmC9FJVQ42b@redis-15858.crce204.eu-west-2-3.ec2.redns.redis-cloud.com:15858/0